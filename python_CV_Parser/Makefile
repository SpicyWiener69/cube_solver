PREFIX=rubiks-cube-NxNxN-solver

clean:
	rm -rf build dist venv rubikscubennnsolver.egg-info cache ida_search ida_search_via_graph my-pt-states.txt
	rm -rf $(PREFIX)/build $(PREFIX)/dist venv \
	       $(PREFIX)/rubikscubennnsolver.egg-info $(PREFIX)/cache \
	       $(PREFIX)/ida_search $(PREFIX)/ida_search_via_graph \
	       $(PREFIX)/my-pt-states.txt
	find $(PREFIX) -name __pycache__ | xargs rm -rf

init: clean
	gcc -O3 -o $(PREFIX)/ida_search_via_graph \
	    $(PREFIX)/rubikscubennnsolver/ida_search_core.c \
	    $(PREFIX)/rubikscubennnsolver/rotate_xxx.c \
	    $(PREFIX)/rubikscubennnsolver/ida_search_666.c \
	    $(PREFIX)/rubikscubennnsolver/ida_search_777.c \
	    $(PREFIX)/rubikscubennnsolver/ida_search_via_graph.c -lm
	python3 -m venv venv
#switch to solver library requirements and install them outside
	(cd $(PREFIX) && ../venv/bin/python3 -m pip install -U pip)
	(cd $(PREFIX) && CRYPTOGRAPHY_DONT_BUILD_RUST=1 ../venv/bin/python3 -m pip install -r requirements.dev.txt)
	(cd $(PREFIX) && CRYPTOGRAPHY_DONT_BUILD_RUST=1 ../venv/bin/python3 -m pip check)
#install native dependencies
	venv/bin/python3 -m pip install -r requirements.txt


test:
	$(PREFIX)/rubiks-cube-solver.py --state DLRRFULLDUBFDURDBFBRBLFU
	$(PREFIX)/rubiks-cube-solver.py --state RRBBUFBFBRLRRRFRDDURUBFBBRFLUDUDFLLFFLLLLDFBDDDUUBDLUU
	$(PREFIX)/rubiks-cube-solver.py --state BRBLLLBRDLBBDDRRFUDFUDUDFUDDDRURBBBUUDRLFRDLLFBRFLRFLFFFBRULDRUBUBBLDBFRDLLUBUDDULFLRRFLFUBFUFUR
	$(PREFIX)/rubiks-cube-solver.py --state RFFFUDUDURBFULULFDBLRLDUFDBLUBBBDDURLRDRFRUDDBFUFLFURRLDFRRRUBFUUDUFLLBLBBULDDRRUFUUUBUDFFDRFLRBBLRFDLLUUBBRFRFRLLBFRLBRRFRBDLLDDFBLRDLFBBBLBLBDUUFDDD
	$(PREFIX)/rubiks-cube-solver.py --state FBDDDFFUDRFBBLFLLURLDLLUFBLRFDUFLBLLFBFLRRBBFDRRDUBUFRBUBRDLUBFDRLBBRLRUFLBRBDUDFFFDBLUDBBLRDFUUDLBBBRRDRUDLBLDFRUDLLFFUUBFBUUFDLRUDUDBRRBBUFFDRRRDBULRRURULFDBRRULDDRUUULBLLFDFRRFDURFFLDUUBRUFDRFUBLDFULFBFDDUDLBLLRBL
	$(PREFIX)/rubiks-cube-solver.py --state DBDBDDFBDDLUBDLFRFRBRLLDUFFDUFRBRDFDRUFDFDRDBDBULDBDBDBUFBUFFFULLFLDURRBBRRBRLFUUUDUURBRDUUURFFFLRFLRLDLBUFRLDLDFLLFBDFUFRFFUUUFURDRFULBRFURRBUDDRBDLLRLDLLDLUURFRFBUBURBRUDBDDLRBULBULUBDBBUDRBLFFBLRBURRUFULBRLFDUFDDBULBRLBUFULUDDLLDFRDRDBBFBUBBFLFFRRUFFRLRRDRULLLFRLFULBLLBBBLDFDBRBFDULLULRFDBR
	$(PREFIX)/rubiks-cube-solver.py --state ULBDLDBUFRBBBBBLBFFFDFRFBBDDFDFRFFLDLDLURRBUDRRBFLUDFRLBDURULRUUDBBBUBRURRRLDLRFFUFFFURRFBLLRRFLFUDBDRRDFULLLURFBFUUBDBBDBFLFDFUUFDUBRLUFDBLRFLUDUFBFDULDFRUBLBBBUBRRDBDDDDFURFLRDBRRLLRFUFLRDFDUULRRDULFDUDRFLBFRLDUDBDFLDBDUFULULLLBUUFDFFDBBBRBRLFLUFLFUFFRLLLFLBUDRRFDDUDLFLBRDULFLBLLULFLDLUULBUDRDFLUDDLLRBLUBBRFRRLDRDUUFLDDFUFLBDBBLBURBBRRRFUBLBRBRUBFFDBBBBLBUFBLURBLDRFLFBUDDFFRFFRLBDBDUURBUFBDFFFLFBDLDUFFBRDLBRLRLBFRUUUULRRBDBRRFDLLRRUUBDBDBFDLRDDBRUUUUUBLLURBDFUFLLRDBLRRBBLBDDBBFUDUDLDLUFDDDUURBFUFRRBLLURDDRURRURLBLDRFRUFBDRULUFFDUDLBBUURFDUDBLRRUDFRLLDULFUBFDLURFBFULFLRRRRRFDDDLFDDRUFRRLBLUBU
